# ğŸ—ï¸ SynClass - Arsitektur & Konsep Sistem

> **Panduan lengkap untuk memahami arsitektur, konsep, dan teknologi yang digunakan di SynClass**

## ğŸ“‹ Daftar Isi

- [Diagram Arsitektur Lengkap](#diagram-arsitektur-lengkap)
- [Layer-by-Layer Explanation](#layer-by-layer-explanation)
- [Data Flow: Login hingga Mendapatkan Data](#data-flow-login-hingga-mendapatkan-data)
- [Security Layers](#security-layers)
- [Database Schema](#database-schema)
- [API Design Pattern](#api-design-pattern)

---

## Diagram Arsitektur Lengkap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DEPLOYMENT LAYER (Cloud)                            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                        VERCEL HOSTING                              â”‚     â”‚
â”‚  â”‚  â€¢ Serverless Functions                                            â”‚     â”‚
â”‚  â”‚  â€¢ Edge Network (CDN)                                               â”‚     â”‚
â”‚  â”‚  â€¢ Auto-scaling                                                     â”‚     â”‚
â”‚  â”‚  â€¢ HTTPS/SSL by default                                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT LAYER (Multi-Platform)                      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   WEB APPLICATION        â”‚            â”‚    MOBILE APPLICATION     â”‚      â”‚
â”‚  â”‚   (Browser-based)        â”‚            â”‚    (Flutter/React Native) â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ â€¢ Next.js Frontend       â”‚            â”‚ â€¢ REST API Client         â”‚      â”‚
â”‚  â”‚ â€¢ React 19 Components    â”‚            â”‚ â€¢ HTTP/HTTPS Requests     â”‚      â”‚
â”‚  â”‚ â€¢ Tailwind CSS           â”‚            â”‚ â€¢ JWT Token Storage       â”‚      â”‚
â”‚  â”‚ â€¢ Supabase Client        â”‚            â”‚ â€¢ Secure Storage          â”‚      â”‚
â”‚  â”‚ â€¢ Server Components      â”‚            â”‚ â€¢ JSON Parser             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚              â”‚                                     â”‚                        â”‚
â”‚              â”‚  HTTP/HTTPS                         â”‚  HTTP/HTTPS            â”‚
â”‚              â”‚  (Supabase SDK)                     â”‚  (REST API)            â”‚
â”‚              â”‚                                     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                     â”‚
               â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APPLICATION LAYER (Backend)                         â”‚
â”‚                            Next.js API Routes                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                      PUBLIC ENDPOINTS                              â”‚     â”‚
â”‚  â”‚  (Tidak perlu authentication)                                      â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  POST /api/mobile/auth/login       â†’ Login mahasiswa/dosen        â”‚     â”‚
â”‚  â”‚  POST /api/mobile/auth/refresh     â†’ Refresh access token         â”‚     â”‚
â”‚  â”‚  POST /api/mobile/auth/logout      â†’ Logout user                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                    PROTECTED ENDPOINTS                             â”‚     â”‚
â”‚  â”‚  (Wajib JWT Token + Role Student)                                  â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  GET  /api/mobile/student/profile         â†’ User profile          â”‚     â”‚
â”‚  â”‚  PUT  /api/mobile/student/profile         â†’ Update profile        â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/classes         â†’ Enrolled classes      â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/classes/:id     â†’ Class detail          â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/krs             â†’ KRS data              â”‚     â”‚
â”‚  â”‚  POST /api/mobile/student/krs             â†’ Submit KRS            â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/grades          â†’ Grades & transcript   â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/attendance      â†’ Attendance records    â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/assignments     â†’ Assignment list       â”‚     â”‚
â”‚  â”‚  POST /api/mobile/student/assignments/:id/submit â†’ Submit tugas   â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/materials       â†’ Learning materials    â”‚     â”‚
â”‚  â”‚  GET  /api/mobile/student/matakuliah      â†’ Available courses     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                      ADMIN ENDPOINTS                               â”‚     â”‚
â”‚  â”‚  (Wajib SERVICE_ROLE_KEY - Server-side only)                       â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  POST /api/admin/create-user       â†’ Create user baru             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                   MIDDLEWARE LAYER                                 â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  1. verifyToken()         â†’ Extract & verify JWT                  â”‚     â”‚
â”‚  â”‚  2. checkStudentRole()    â†’ Verify role = 'student'               â”‚     â”‚
â”‚  â”‚  3. errorResponse()       â†’ Standardize error format              â”‚     â”‚
â”‚  â”‚  4. successResponse()     â†’ Standardize success format            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                             HTTPS/WebSocket
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATA LAYER (Supabase Cloud)                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                   AUTHENTICATION SERVICE                          â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  â€¢ JWT Token Generation (HS256)                                   â”‚      â”‚
â”‚  â”‚  â€¢ Token Validation & Refresh                                     â”‚      â”‚
â”‚  â”‚  â€¢ Password Hashing (bcrypt)                                      â”‚      â”‚
â”‚  â”‚  â€¢ Session Management                                             â”‚      â”‚
â”‚  â”‚  â€¢ Email Verification                                             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Tables:                                                          â”‚      â”‚
â”‚  â”‚  â”œâ”€ auth.users (user credentials - managed by Supabase)          â”‚      â”‚
â”‚  â”‚  â””â”€ auth.sessions (active sessions)                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                   POSTGRESQL DATABASE                             â”‚      â”‚
â”‚  â”‚                   (Relational Database)                           â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚  USER & PROFILE TABLES                                  â”‚      â”‚      â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ profiles (extended user data)                        â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ id (FK â†’ auth.users)                              â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ username, email, nim, nidn                        â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ role (student/dosen/kaprodi)                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ jurusan, fakultas, angkatan                       â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: User hanya akses data sendiri               â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚  ACADEMIC TABLES                                        â”‚      â”‚      â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ matakuliah (courses)                                 â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ nama_mk, kode_mk, sks                             â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ dosen_id (FK â†’ profiles)                          â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ hari, jam_mulai, jam_selesai, ruang              â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Public read for authenticated users         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚                                                         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ krs_pengajuan (student enrollment)                  â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ mahasiswa_id (FK â†’ profiles)                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ matakuliah_id (FK â†’ matakuliah)                   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ status (pending/approved/rejected)               â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ semester, tahun_ajaran                           â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Students see own, Kaprodi see all          â”‚      â”‚      â”‚
â”‚  â”‚  â”‚                                                         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ nilai (grades)                                       â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ mahasiswa_id (FK â†’ profiles)                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ matakuliah_id (FK â†’ matakuliah)                   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ nilai_angka, nilai_huruf, semester              â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Students see own grades only               â”‚      â”‚      â”‚
â”‚  â”‚  â”‚                                                         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ presensi_session (attendance sessions)              â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ matakuliah_id (FK â†’ matakuliah)                   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ tanggal, pertemuan_ke, qr_code                  â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Dosen manage, Students read                â”‚      â”‚      â”‚
â”‚  â”‚  â”‚                                                         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ presensi_mahasiswa (student attendance)             â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ session_id (FK â†’ presensi_session)               â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ mahasiswa_id (FK â†’ profiles)                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ status (hadir/izin/sakit/alpha)                 â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Students see own, Dosen see class          â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚  LEARNING MANAGEMENT TABLES                             â”‚      â”‚      â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ post (materials, assignments, announcements)         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ matakuliah_id (FK â†’ matakuliah)                   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ author_id (FK â†’ profiles - dosen)                 â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ jenis_post (materi/tugas/pengumuman)             â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ judul, konten, file_url                          â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ deadline (untuk tugas)                           â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Students read, Dosen CRUD                   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚                                                         â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ tugas_submission (assignment submissions)           â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ post_id (FK â†’ post)                               â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ mahasiswa_id (FK â†’ profiles)                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ jawaban, file_url                                â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â”œâ”€ submitted_at, nilai                              â”‚      â”‚      â”‚
â”‚  â”‚  â”‚    â””â”€ RLS: Students submit own, Dosen grade            â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚  ROW LEVEL SECURITY (RLS) POLICIES                      â”‚      â”‚      â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚      â”‚
â”‚  â”‚  â”‚  Semua tabel di atas memiliki RLS policies:             â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ ENABLE ROW LEVEL SECURITY                            â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ CREATE POLICY untuk SELECT, INSERT, UPDATE, DELETE   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ Berdasarkan auth.uid() dan role                      â”‚      â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ Automatic data filtering per user                    â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                      STORAGE SERVICE                              â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  â€¢ File Upload/Download (images, PDFs, documents)                 â”‚      â”‚
â”‚  â”‚  â€¢ CDN Integration                                                â”‚      â”‚
â”‚  â”‚  â€¢ Access Control (RLS for buckets)                               â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Layer-by-Layer Explanation

### 1. **Deployment Layer (Vercel)**

**Fungsi:** Hosting aplikasi di cloud dengan serverless architecture

**Komponen:**
- **Serverless Functions** - API routes di-deploy sebagai functions
- **Edge Network** - CDN untuk static assets
- **Auto-scaling** - Otomatis scale sesuai traffic
- **HTTPS/SSL** - Enkripsi koneksi by default

**Keuntungan:**
- âœ… Zero configuration deployment
- âœ… Automatic HTTPS
- âœ… Global CDN
- âœ… Environment variables management
- âœ… Git integration (auto-deploy on push)

---

### 2. **Client Layer (Multi-Platform)**

**A. Web Application (Next.js Frontend)**

```
User mengakses: https://synclass.vercel.app
       â†“
Next.js Server Components render HTML
       â†“
Kirim ke browser
       â†“
React hydration (interactivity)
       â†“
Supabase Client connect ke database
```

**Fitur:**
- Server-side rendering (SSR)
- Client-side navigation
- Supabase realtime subscriptions
- Automatic code splitting

**B. Mobile Application (Flutter/React Native)**

```
User buka app
       â†“
Load dari secure storage: access_token
       â†“
HTTP request ke API dengan Bearer token
       â†“
Parse JSON response
       â†“
Display data
```

**Fitur:**
- REST API integration
- Secure token storage
- Offline capability (cache)
- Push notifications (future)

---

### 3. **Application Layer (Next.js Backend)**

**Architecture Pattern:** Model-View-Controller (MVC)

```
Request â†’ Middleware â†’ Controller â†’ Model â†’ Database
                          â†“
                      Response
```

#### **Middleware Functions** (`app/api/mobile/lib/auth.ts`):

```typescript
// 1. Token Verification
export async function verifyToken(request: NextRequest) {
  const token = request.headers.get('authorization')?.split(' ')[1];
  
  if (!token) {
    return errorResponse('Missing token', 'NO_TOKEN', 401);
  }
  
  const { data: { user }, error } = await supabase.auth.getUser(token);
  
  if (error) {
    return errorResponse('Invalid token', 'INVALID_TOKEN', 401);
  }
  
  return { success: true, userId: user.id, userEmail: user.email };
}

// 2. Role Verification
export async function checkStudentRole(userId: string) {
  const { data: profile } = await supabase
    .from('profiles')
    .select('role')
    .eq('id', userId)
    .single();
  
  if (profile.role !== 'student') {
    return errorResponse('Access denied', 'INVALID_ROLE', 403);
  }
  
  return { success: true };
}

// 3. Standard Response Helpers
export function successResponse(data: any, message = 'Success', status = 200) {
  return NextResponse.json({ success: true, data, message }, { status });
}

export function errorResponse(error: string, code: string, status = 400) {
  return NextResponse.json({ success: false, error, code }, { status });
}
```

#### **Controller Example** (`app/api/mobile/student/profile/route.ts`):

```typescript
export async function GET(request: NextRequest) {
  // 1. Verify JWT Token
  const tokenResult = await verifyToken(request);
  if (!tokenResult.success) {
    return errorResponse('Unauthorized', 'NO_TOKEN', 401);
  }
  
  // 2. Check Role
  const roleResult = await checkStudentRole(tokenResult.userId!);
  if (!roleResult.success) {
    return errorResponse('Access denied', 'INVALID_ROLE', 403);
  }
  
  // 3. Query Database (with RLS auto-filter)
  const { data: profile, error } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', tokenResult.userId)
    .single();
  
  if (error) {
    return errorResponse('Profile not found', 'NOT_FOUND', 404);
  }
  
  // 4. Return Success Response
  return successResponse(profile);
}
```

---

### 4. **Data Layer (Supabase)**

#### **A. Authentication Service**

**Flow:**
```
1. User kirim email + password
       â†“
2. Supabase verify credentials di auth.users
       â†“
3. Generate JWT Token:
   {
     sub: user_id,
     role: 'authenticated',
     iat: issued_at,
     exp: expiry (now + 1h)
   }
       â†“
4. Sign dengan secret_key (HS256)
       â†“
5. Return { access_token, refresh_token }
```

**Token Storage:**
- **Server:** Refresh token di database
- **Client:** Access & refresh token di secure storage

#### **B. PostgreSQL Database**

**Relationship Diagram:**

```
auth.users
    â”‚
    â”‚ 1:1
    â–¼
profiles (extended user data)
    â”‚
    â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â–º krs_pengajuan (student enrollments)
    â”‚                  â”‚
    â”‚                  â”‚ N:1
    â”‚                  â–¼
    â”‚             matakuliah (courses)
    â”‚                  â”‚
    â”‚                  â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â–º post (materials/assignments)
    â”‚                  â”‚                  â”‚
    â”‚                  â”‚                  â”‚ 1:N
    â”‚                  â”‚                  â–¼
    â”‚                  â”‚              tugas_submission
    â”‚                  â”‚
    â”‚                  â””â”€â”€â”€â”€ 1:N â”€â”€â”€â–º presensi_session
    â”‚                                     â”‚
    â”‚                                     â”‚ 1:N
    â”‚                                     â–¼
    â”œâ”€â”€â”€â”€ 1:N â”€â”€â”€â–º nilai (grades)   presensi_mahasiswa
    â”‚
    â””â”€â”€â”€â”€ 1:N â”€â”€â”€â–º tugas_submission
```

---

## Data Flow: Login hingga Mendapatkan Data

### **Complete Flow Diagram:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA FLOW: LOGIN TO GET PROFILE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mobile App              Next.js API           Supabase Auth       PostgreSQL
   ğŸ“±                      ğŸ–¥ï¸                     ğŸ”                 ğŸ—„ï¸
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚ 1. POST /auth/login   â”‚                      â”‚                  â”‚
   â”‚ {                     â”‚                      â”‚                  â”‚
   â”‚   email: "student@",  â”‚                      â”‚                  â”‚
   â”‚   password: "12345"   â”‚                      â”‚                  â”‚
   â”‚ }                     â”‚                      â”‚                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                  â”‚
   â”‚                       â”‚ 2. signInWithPasswordâ”‚                  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
   â”‚                       â”‚                      â”‚ 3. Verify        â”‚
   â”‚                       â”‚                      â”‚ credentials      â”‚
   â”‚                       â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚ 4. auth.users    â”‚
   â”‚                       â”‚                      â”‚ WHERE email=     â”‚
   â”‚                       â”‚                      â”‚ bcrypt.compare   â”‚
   â”‚                       â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                      â”‚ User found! âœ“    â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚ 5. Generate JWT      â”‚                  â”‚
   â”‚                       â”‚ {                    â”‚                  â”‚
   â”‚                       â”‚   sub: user_id,      â”‚                  â”‚
   â”‚                       â”‚   role: student,     â”‚                  â”‚
   â”‚                       â”‚   exp: now+1h        â”‚                  â”‚
   â”‚                       â”‚ }                    â”‚                  â”‚
   â”‚                       â”‚ + Sign(secret_key)   â”‚                  â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚ 6. Get profile data  â”‚                  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                      â”‚ SELECT * FROM    â”‚
   â”‚                       â”‚                      â”‚ profiles         â”‚
   â”‚                       â”‚                      â”‚ WHERE id=user_id â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚ 7. Response:          â”‚                      â”‚                  â”‚
   â”‚ {                     â”‚                      â”‚                  â”‚
   â”‚   success: true,      â”‚                      â”‚                  â”‚
   â”‚   data: {             â”‚                      â”‚                  â”‚
   â”‚     user: {           â”‚                      â”‚                  â”‚
   â”‚       id, email,      â”‚                      â”‚                  â”‚
   â”‚       role, ...       â”‚                      â”‚                  â”‚
   â”‚     },                â”‚                      â”‚                  â”‚
   â”‚     session: {        â”‚                      â”‚                  â”‚
   â”‚       access_token,   â”‚                      â”‚                  â”‚
   â”‚       refresh_token   â”‚                      â”‚                  â”‚
   â”‚     }                 â”‚                      â”‚                  â”‚
   â”‚   }                   â”‚                      â”‚                  â”‚
   â”‚ }                     â”‚                      â”‚                  â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚ 8. Save tokens to     â”‚                      â”‚                  â”‚
   â”‚ secure storage:       â”‚                      â”‚                  â”‚
   â”‚ FlutterSecureStorage  â”‚                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”œâ”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”¤
   â”‚                                                                  â”‚
   â”‚ 9. GET /student/profile                                          â”‚
   â”‚ Header:               â”‚                      â”‚                  â”‚
   â”‚ Authorization:        â”‚                      â”‚                  â”‚
   â”‚ Bearer eyJhbGci...    â”‚                      â”‚                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                  â”‚
   â”‚                       â”‚ 10. Extract token    â”‚                  â”‚
   â”‚                       â”‚ from header          â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚ 11. Verify signature â”‚                  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
   â”‚                       â”‚ supabase.auth        â”‚                  â”‚
   â”‚                       â”‚ .getUser(token)      â”‚                  â”‚
   â”‚                       â”‚                      â”‚ 12. Validate     â”‚
   â”‚                       â”‚                      â”‚ signature with   â”‚
   â”‚                       â”‚                      â”‚ secret_key       â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ âœ“ Valid!         â”‚
   â”‚                       â”‚ {                    â”‚                  â”‚
   â”‚                       â”‚   user: {            â”‚                  â”‚
   â”‚                       â”‚     id, email, ...   â”‚                  â”‚
   â”‚                       â”‚   }                  â”‚                  â”‚
   â”‚                       â”‚ }                    â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚ 13. Check role       â”‚                  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                      â”‚ SELECT role FROM â”‚
   â”‚                       â”‚                      â”‚ profiles         â”‚
   â”‚                       â”‚                      â”‚ WHERE id=user_id â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚ role = 'student' âœ“   â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚ 14. Query profile    â”‚                  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚ (RLS active!)        â”‚ SELECT * FROM    â”‚
   â”‚                       â”‚                      â”‚ profiles         â”‚
   â”‚                       â”‚                      â”‚ WHERE id=user_id â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚ RLS Policy:      â”‚
   â”‚                       â”‚                      â”‚ auth.uid()=id âœ“  â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚ 15. Response:         â”‚                      â”‚                  â”‚
   â”‚ {                     â”‚                      â”‚                  â”‚
   â”‚   success: true,      â”‚                      â”‚                  â”‚
   â”‚   data: {             â”‚                      â”‚                  â”‚
   â”‚     id, username,     â”‚                      â”‚                  â”‚
   â”‚     email, nim,       â”‚                      â”‚                  â”‚
   â”‚     jurusan, ...      â”‚                      â”‚                  â”‚
   â”‚   }                   â”‚                      â”‚                  â”‚
   â”‚ }                     â”‚                      â”‚                  â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
   â”‚ 16. Display profile   â”‚                      â”‚                  â”‚
   â”‚ di UI mobile app      â”‚                      â”‚                  â”‚
   â”‚                       â”‚                      â”‚                  â”‚
```

---

## Security Layers

SynClass memiliki **6 lapisan keamanan** yang bekerja secara berurutan:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              6 LAPISAN KEAMANAN SYNCLASS                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REQUEST dari client
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: HTTPS/TLS Encryption                â”‚
â”‚ â€¢ Semua traffic terenkripsi                  â”‚
â”‚ â€¢ Man-in-the-middle attack prevention        â”‚
â”‚ â€¢ Certificate validation                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: JWT Token Validation                â”‚
â”‚ â€¢ Extract token dari header                  â”‚
â”‚ â€¢ Verify signature dengan secret_key         â”‚
â”‚ â€¢ Check expiry time                          â”‚
â”‚ â€¢ Decode payload (user_id, role)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Role-Based Access Control (RBAC)    â”‚
â”‚ â€¢ Check user.role === 'student'              â”‚
â”‚ â€¢ Endpoint /student/* hanya untuk student    â”‚
â”‚ â€¢ Endpoint /dosen/* hanya untuk dosen        â”‚
â”‚ â€¢ Endpoint /admin/* hanya untuk admin        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Row Level Security (RLS)            â”‚
â”‚ â€¢ Database-level filtering                   â”‚
â”‚ â€¢ auth.uid() = user_id check                 â”‚
â”‚ â€¢ Automatic per-row permissions              â”‚
â”‚ â€¢ Cannot be bypassed from client             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: Business Logic Validation           â”‚
â”‚ â€¢ Input validation (email format, etc)       â”‚
â”‚ â€¢ Business rules (max 24 SKS, etc)           â”‚
â”‚ â€¢ Data integrity checks                      â”‚
â”‚ â€¢ Prevent invalid operations                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 6: Database Constraints                â”‚
â”‚ â€¢ Foreign key constraints                    â”‚
â”‚ â€¢ NOT NULL constraints                       â”‚
â”‚ â€¢ UNIQUE constraints                         â”‚
â”‚ â€¢ Check constraints                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
            PROCESS REQUEST
                   â”‚
                   â–¼
            RETURN RESPONSE
```

### **Public vs Protected Endpoints**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ENDPOINT CLASSIFICATION                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PUBLIC ENDPOINTS (No Authentication Required)
â”œâ”€ POST /api/mobile/auth/login       â† Anyone can access
â”œâ”€ POST /api/mobile/auth/refresh     â† Refresh token only
â””â”€ POST /api/mobile/auth/logout      â† Cleanup session

PROTECTED ENDPOINTS (JWT Token Required + Role Check)
â”œâ”€ Student Endpoints (role = 'student')
â”‚  â”œâ”€ GET  /api/mobile/student/profile
â”‚  â”œâ”€ PUT  /api/mobile/student/profile
â”‚  â”œâ”€ GET  /api/mobile/student/classes
â”‚  â”œâ”€ GET  /api/mobile/student/krs
â”‚  â”œâ”€ POST /api/mobile/student/krs
â”‚  â”œâ”€ GET  /api/mobile/student/grades
â”‚  â”œâ”€ GET  /api/mobile/student/attendance
â”‚  â”œâ”€ GET  /api/mobile/student/assignments
â”‚  â”œâ”€ POST /api/mobile/student/assignments/:id/submit
â”‚  â”œâ”€ GET  /api/mobile/student/materials
â”‚  â””â”€ GET  /api/mobile/student/matakuliah
â”‚
â”œâ”€ Dosen Endpoints (role = 'dosen') [Future]
â”‚  â”œâ”€ GET  /api/mobile/dosen/classes
â”‚  â”œâ”€ GET  /api/mobile/dosen/students
â”‚  â””â”€ POST /api/mobile/dosen/attendance/create
â”‚
â””â”€ Admin Endpoints (SERVICE_ROLE_KEY required)
   â””â”€ POST /api/admin/create-user
```

---

## Database Schema

### **Entity Relationship Diagram (ERD):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE SCHEMA (ERD)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.users     â”‚ (Managed by Supabase)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚
â”‚ email (UNIQUE)   â”‚
â”‚ encrypted_pass   â”‚
â”‚ email_confirmed  â”‚
â”‚ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1:1
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   profiles                  â”‚ (Extended user data)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK, FKâ†’auth.users)      â”‚
â”‚ username                    â”‚
â”‚ email                       â”‚
â”‚ role (student/dosen/kaprodi)â”‚
â”‚ nim (for students)          â”‚
â”‚ nidn (for lecturers)        â”‚
â”‚ nama_lengkap                â”‚
â”‚ jurusan                     â”‚
â”‚ fakultas                    â”‚
â”‚ angkatan                    â”‚
â”‚ created_at                  â”‚
â”‚ updated_at                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                   â”‚  krs_pengajuan              â”‚
       â”‚                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                   â”‚ id (PK)                     â”‚
       â”‚                                   â”‚ mahasiswa_id (FKâ†’profiles)  â”‚
       â”‚                                   â”‚ matakuliah_id (FKâ†’matakuliah)â”‚
       â”‚                                   â”‚ semester                    â”‚
       â”‚                                   â”‚ tahun_ajaran                â”‚
       â”‚                                   â”‚ status (pending/approved)   â”‚
       â”‚                                   â”‚ catatan                     â”‚
       â”‚                                   â”‚ created_at                  â”‚
       â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                              â”‚ N:1
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1:N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                  â”‚  matakuliah                  â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚ id (PK)                      â”‚
       â”‚                                  â”‚ kode_mk (UNIQUE)             â”‚
       â”‚                                  â”‚ nama_mk                      â”‚
       â”‚                                  â”‚ sks                          â”‚
       â”‚                                  â”‚ semester                     â”‚
       â”‚                                  â”‚ dosen_id (FKâ†’profiles)       â”‚
       â”‚                                  â”‚ hari (enum)                  â”‚
       â”‚                                  â”‚ jam_mulai (time)             â”‚
       â”‚                                  â”‚ jam_selesai (time)           â”‚
       â”‚                                  â”‚ ruang                        â”‚
       â”‚                                  â”‚ kuota                        â”‚
       â”‚                                  â”‚ created_at                   â”‚
       â”‚                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚                                         â”‚ 1:N              â”‚ 1:N
       â”‚                                         â–¼                  â–¼
       â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                  â”‚ post            â”‚  â”‚ presensi_session â”‚
       â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                  â”‚ id (PK)         â”‚  â”‚ id (PK)          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ matakuliah_id   â”‚  â”‚ matakuliah_id    â”‚
       â”‚ (author)                         â”‚ author_id (FK)  â”‚  â”‚ tanggal          â”‚
       â”‚ 1:N                              â”‚ jenis_post      â”‚  â”‚ pertemuan_ke     â”‚
       â”‚                                  â”‚ judul           â”‚  â”‚ qr_code          â”‚
       â”‚                                  â”‚ konten          â”‚  â”‚ created_at       â”‚
       â”‚                                  â”‚ file_url        â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚ deadline        â”‚         â”‚ 1:N
       â”‚                                  â”‚ created_at      â”‚         â–¼
       â”‚                                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                         â”‚ 1:N         â”‚ presensi_mahasiswa   â”‚
       â”‚                                         â–¼             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ id (PK)              â”‚
       â”‚ 1:N                  â”‚         â”‚ tugas_submission    â”‚ session_id (FK)      â”‚
       â”‚                      â–¼         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ mahasiswa_id (FK)    â”‚
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ id (PK)             â”‚ status (hadir/alpha) â”‚
       â”‚              â”‚ nilai            â”‚ post_id (FKâ†’post)   â”‚ timestamp            â”‚
       â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ mahasiswa_id (FK)   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚ id (PK)          â”‚ jawaban             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ mahasiswa_id (FK)â”‚ file_url            â”‚
                      â”‚ matakuliah_id    â”‚ nilai               â”‚
                      â”‚ semester         â”‚ feedback            â”‚
                      â”‚ nilai_angka      â”‚ submitted_at        â”‚
                      â”‚ nilai_huruf      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ ips              â”‚
                      â”‚ created_at       â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Foreign Key Relationships:**

| Table | Foreign Key | References | On Delete |
|-------|-------------|------------|-----------|
| `profiles` | `id` | `auth.users.id` | CASCADE |
| `krs_pengajuan` | `mahasiswa_id` | `profiles.id` | CASCADE |
| `krs_pengajuan` | `matakuliah_id` | `matakuliah.id` | CASCADE |
| `nilai` | `mahasiswa_id` | `profiles.id` | CASCADE |
| `nilai` | `matakuliah_id` | `matakuliah.id` | CASCADE |
| `post` | `matakuliah_id` | `matakuliah.id` | CASCADE |
| `post` | `author_id` | `profiles.id` | SET NULL |
| `tugas_submission` | `post_id` | `post.id` | CASCADE |
| `tugas_submission` | `mahasiswa_id` | `profiles.id` | CASCADE |
| `presensi_session` | `matakuliah_id` | `matakuliah.id` | CASCADE |
| `presensi_mahasiswa` | `session_id` | `presensi_session.id` | CASCADE |
| `presensi_mahasiswa` | `mahasiswa_id` | `profiles.id` | CASCADE |
| `matakuliah` | `dosen_id` | `profiles.id` | SET NULL |

**ON DELETE CASCADE:** Jika parent dihapus, child juga terhapus
**ON DELETE SET NULL:** Jika parent dihapus, FK di child jadi NULL

---

## API Design Pattern

SynClass mengikuti **RESTful API Design Best Practices:**

### **1. Resource-Based URLs**

```
âœ… GOOD:
GET    /api/mobile/student/profile         â†’ Resource: profile
GET    /api/mobile/student/classes         â†’ Resource: classes (collection)
GET    /api/mobile/student/classes/:id     â†’ Resource: specific class
POST   /api/mobile/student/krs             â†’ Create KRS
DELETE /api/mobile/student/krs/:id         â†’ Delete specific KRS

âŒ BAD:
GET  /api/getStudentProfile
GET  /api/getAllClassesForCurrentStudent
POST /api/createNewKRS
POST /api/deleteKRSById
```

### **2. HTTP Status Codes**

| Code | Meaning | Use Case |
|------|---------|----------|
| **200** | OK | Success (GET, PUT, PATCH) |
| **201** | Created | Resource created (POST) |
| **204** | No Content | Success but no body (DELETE) |
| **400** | Bad Request | Invalid input |
| **401** | Unauthorized | Missing/invalid token |
| **403** | Forbidden | Valid token, wrong role |
| **404** | Not Found | Resource doesn't exist |
| **500** | Internal Server Error | Server error |

### **3. Standard Response Format**

**Success Response:**
```json
{
  "success": true,
  "data": {
    // Actual data here
  },
  "message": "Operation successful"
}
```

**Error Response:**
```json
{
  "success": false,
  "error": "Human-readable error message",
  "code": "ERROR_CODE_UPPERCASE"
}
```

### **4. API Versioning (Future)**

```
/api/v1/mobile/student/profile
/api/v2/mobile/student/profile  â† New version with breaking changes
```

### **5. Pagination (for large datasets)**

```
GET /api/mobile/student/classes?page=1&limit=10

Response:
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 50,
    "totalPages": 5
  }
}
```

---

## Kesimpulan

SynClass dibangun dengan **modern web architecture** yang:

âœ… **Scalable** - Serverless di Vercel, auto-scale
âœ… **Secure** - 6 lapisan keamanan (HTTPS, JWT, RBAC, RLS, etc)
âœ… **Maintainable** - Clean code, separation of concerns
âœ… **Performant** - RLS di database, CDN, caching
âœ… **Multi-platform** - Web + Mobile API
âœ… **Developer-friendly** - RESTful API, standard format, documentation

**Tech Stack Summary:**
- **Frontend:** Next.js 15, React 19, Tailwind CSS
- **Backend:** Next.js API Routes (serverless)
- **Database:** PostgreSQL (Supabase)
- **Auth:** JWT Token (Supabase Auth)
- **Security:** RLS, RBAC, HTTPS
- **Deployment:** Vercel (serverless)
- **API:** RESTful, JSON
